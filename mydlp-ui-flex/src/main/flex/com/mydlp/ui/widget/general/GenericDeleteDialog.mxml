<?xml version="1.0" encoding="utf-8"?>
<general:GenericCRUDDialog xmlns:fx="http://ns.adobe.com/mxml/2009" 
				xmlns:s="library://ns.adobe.com/flex/spark" 
				xmlns:mx="library://ns.adobe.com/flex/mx"
				xmlns:general="com.mydlp.ui.widget.general.*"
				xmlns:my="http://www.mydlp.com/flex/my"
				>
	
	<fx:Script>
		<![CDATA[
			import com.mydlp.ui.domain.AbstractEntity;
			import com.mydlp.ui.domain.AbstractNamedEntity;
			import com.mydlp.ui.domain.InventoryCategory;
			import com.mydlp.ui.util.ClassMember;
			import com.mydlp.ui.util.InteractionUtil;
			import com.mydlp.ui.util.LangUtil;
			import com.mydlp.ui.util.ReflectionUtil;
			
			import mx.controls.Alert;
			import mx.controls.Button;
			import mx.controls.Label;
			import mx.core.FlexGlobals;
			
			protected var isAnInventoryItem:Boolean = false;
			
			protected var deleteButton:Button = new Button();
			
			protected var cancelButton:Button = new Button();
			
			public function populateButtons(): void
			{	
				deleteButton.label = LangUtil.getString("messages", "generic.delete." + getSimpleName() + ".deleteButton.label");
				deleteButton.addEventListener(MouseEvent.CLICK, deleteButtonClickHandler);
				cancelButton.label = LangUtil.getString("messages", "generic.delete." + getSimpleName() + ".cancelButton.label");
				cancelButton.addEventListener(MouseEvent.CLICK, cancelButtonClickHandler);
				vbox.addChild(deleteButton);
				vbox.addChild(cancelButton);
			}
			
			public function populateDialogMessage(): void
			{	
				var message:String = "";
				var message2:String = "";
				
				message += LangUtil.getString("messages", "generic.delete." + getSimpleName() + ".dialogMessage");
				message += ": ";
				
				if (formObject is AbstractNamedEntity) 
				{
					var namedEntity:AbstractNamedEntity = formObject as AbstractNamedEntity;
					message += namedEntity.label;
				}
				else if (formObject is AbstractEntity)
				{
					var entity:AbstractEntity = formObject as AbstractEntity;
					message += getSimpleName() + "[" + entity.id + "]";
				}
				else
				{
					message += formObject.toString();
				}
				
				if (message != "") 
				{
					var dialogMessage:Label = new Label();
					dialogMessage.text = message;
					vbox.addChild(dialogMessage);
				}
				
				if (formObject is InventoryCategory)
				{
					message2 += LangUtil.getString("messages", "generic.delete." + getSimpleName() + ".removeAllSubitems");	
				}
				
				if (message2 != "")
				{
					var dialogMessage2:Label = new Label();
					dialogMessage2.text = message2;
					vbox.addChild(dialogMessage2);
				}
			}
			
			override public function populate(): void
			{
				title = LangUtil.getString("messages", "generic.delete." + getSimpleName() + ".title");
				
				if (ReflectionUtil.hasMemberOfType(formObject, "category", InventoryCategory))
					isAnInventoryItem = true;
					
				populateDialogMessage();
				populateButtons();
				
				super.populate();
			}
			
			protected function deleteButtonClickHandler(event:Event): void
			{
				re.remove(formObject);
				deleteButton.enabled = false;
				cancelButton.enabled = false;
			}
			
			protected function cancelButtonClickHandler(event:Event): void
			{
				InteractionUtil.closePopup(this);
			}
			
			protected function okHandler(event:Event): void
			{
				InteractionUtil.closePopup(this);
				Alert.show(	LangUtil.getString("messages", "generic.delete." + getSimpleName() + ".ok.message"),
							LangUtil.getString("messages", "generic.delete." + getSimpleName() + ".title"));
				if (isAnInventoryItem)
					FlexGlobals.topLevelApplication.inventoryTree.refreshTree();
			}
			
		]]>
	</fx:Script>
	
	<fx:Declarations>
		<my:remote id="re" destination="genericBRS" >
			<my:method name="remove" result="okHandler(event)" />
		</my:remote>
	</fx:Declarations>
	
	<mx:VBox id="vbox"/>
</general:GenericCRUDDialog>
